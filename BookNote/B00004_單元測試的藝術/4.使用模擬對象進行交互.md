# 內容

- 定義交互測試
- 理解模擬對象
- 區分偽對象/模擬對象/存根
- 探索使用模擬對象的最佳實踐

工作單元有三種結果：

- 返回值
- 狀態改變
- 調用第三方對象

使用模擬對象可以檢驗單元是否正確調用了第三方對象
第一件事：定義交互測試,弄清楚它與基準值和基於狀態的測試有何不同

## 基於值/狀態的測試,交互測試

交互測試：對一個對象如何向其他對象發送消息的測試,如果一個特定的工作單元最後結果是調用另一個對象,就需要進行交互測試

交互測試可被視為行為驅動測試(action-driven):

- 測試一個對象採取的特定行為

## 模擬對象/偽對象/存根

- 模擬對象
  - 系統中的偽對象
  - 可驗證被測試對象是否按預期調用了這個偽對象
  - 每個測試作多有一個模擬對象
- 偽對象
  - 描述一個存根/模擬對象

## 模擬對象 vs 存根

理解二者區別,可以更仔細評估各種工具,框架,API
使用存根時,對被測試類進行斷言,存根只是輔助測試運行
存根不會導致測試失敗,但是模擬對象會

ex: e_4_1

斷言不是直接寫在模擬對象內部的,而是寫在測試中,原因：

- 你希望其他測試使用這個模擬對象,但是不希望這些測試斷言
- 如果斷言寫在模擬對象內部,看代碼者不能看到具體斷言
  - 降低可讀性

## 同時使用模擬對象和存根

ex: e_4_2

- 有時,使用多個斷言會產生問題
  - 測試中第一次斷言失敗時,會拋出特殊類型的異常,由測試運行器捕獲 -> 後續斷言不會被執行
  - 如果既使第一個斷言失敗,其他斷言也需要執行,說明你需要把測試拆成幾個

## 一個測試一個模擬對象
一個測試只測一件事情,測試中最多只有一個模擬對象
其它偽對象都是存根

如果你發現測試對一些偽對象進行斷言,而這些偽對象明顯是用作存根-> 這是"過度指定"的症狀
過度指定(overspecification)是過多指定測試中應該發生的事情的行為,而這些事實際上對測試無關緊要
-> 有可能導致測試因為錯誤的原因失敗

一個測試只能指定工作單元的三種最終結果的一個

## 偽對象鏈: 用存根生成模擬對象或其他存根
釣魚網站使用

## 手工模擬對象和存根的問題
手工模擬對象和存根會出現如下問題：
- 花費時間
- 如果類和接口有許多方法,屬性或事件,就很難編寫存根和模擬對象
- 要保存模擬對象多次調用狀態,你需要在偽實現中寫很多標準代碼
- 驗證所有參數正確要寫多次斷言
- 難以重用,代碼維護麻煩
- 