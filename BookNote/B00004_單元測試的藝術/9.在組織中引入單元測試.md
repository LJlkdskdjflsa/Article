# 在組織中引入單元測試

## 內容

- 成為一個變革的提倡者
- 成功之道
- 失敗的原因
- 自上而下還是自下而上變革
- 準備好回答關於單元測試的質疑

任何類型的組織中，要改變人們的習慣，更多是做出心理上的改變，而非技術上的
人們不喜歡改變，改變通常伴隨大量的 FUD

## 9.1 逐步成為變革倡導者

首先應該先接受這個角色，並且要準備對發生的事負責(總是需要有人擔起責任，確保變革不會因為缺乏動力而失敗)

每個角色會對變革有自己的想法：
- 角色
  - RD
  - QA
- 想法
  - 我們怎麼知道這個有效

必須先準備好回答所有問題
-> 在開始前說服所有人有很大的幫助

### 步驟：
- 準備好面對質疑
- 說服組織內的成員：支持者與反對者
  - 支持者：剛開始倡導變革時，要找出最有可能幫助你的人
    - 喜歡嘗試新技術者
    - 思想開明、願意嘗試你倡導事情的人
    - 先跟這些人徵求意見和交流，讓他們成為過程的參與者（過程參與者會更努力幫你過程）
  - 反對者：最有可能阻礙你變革的人
    - ex. 經理會覺得單元測試增加開發時間、需要維護的代碼
    - 他們會阻礙變革
    - 拉攏他們的最好方式是，請他們幫助，讓他們成為過程參與者
- 找到可能的切入點
  - 找到組織中何處可以開始實施變革
  - 大多數成功實施的路線：
    - 從一個小團隊的試點項目開始，如果成功就往外推展
    - 建議
      - 選擇較小團隊 -> 比較有風險承受能力
      - 創建子團隊 -> 抓出團隊中的"黑洞"組件
      - 考慮項目可行性 -> 先從小目標開始
      - 使用代碼測試和審查作為培訓工具
        - Peer Review
        - 建立規則標準

## 9.2 成功之道

兩種改變方式：
- 自上而下
- 自下而上

### 自下而上（游擊式實現）
從一個團隊開始改變 -> 獲得成功 -> 說服其他人

### 自上而下（說服高層）
用權力來推動變革

### 引入外援（邀請業界專家）
請外部顧問有很多好處
- 言論自由：顧問可以說出內部人不方便說的(ex. 代碼完整性很差、測試可讀性很差)
- 經驗：顧問通常經驗豐富，知道如何處理來自公司內部壓力
- 專有時間：專職 -> 有專有時間來實現變革

### 使進度可見
用圖表呈現，並且放在顯眼的地方

### 設定具體目標
-> 如果只給開發者邊寫測試卻不設定覆蓋率，大部分的人都會高估覆蓋率

量化標準
- 提高測試代碼覆蓋率與代碼改動的比率
  - 代碼改動比率越低代表出問題機會也越低
- 減少重現的缺陷
  - 修復缺陷時容易不小心破壞其他功能，如果缺陷能不經常重現，表示能在不破壞原先功能情況下修復缺陷
- 降低修復缺陷的平均時間
  - 良好的測試覆蓋率，可以讓缺陷更容易修復

用於測試過程的幾種度量
- 不同優先級的類的平均缺陷數
- 子程序中的平均缺陷數，發現缺陷所需所需的平均測試時間
- 測試用例發現的平均缺陷數

## 9.3 失敗原因

- 缺少驅動力
  - 必須要付出額外的時間
    - 培訓
    - 幫助解決問題
- 缺乏政策支持
  - 上級不給資源
- 不好的實現和第一印象
  - 要在開始的幾個月之內能夠看到成果
    - 不然很難說服他人
  - 如果你不知道怎麼做
    - 花錢請顧問
- 缺少團隊支持
  - 如果沒有團隊支持，很難成功
  - 努力讓團隊成為新過程的參與者


## 9.4 影響因素
書：
- Notes to a Software Team Leader
- Influencer: The Power to Change Anything

## 9.5 質疑和回答

人們提出問題是因為改革可能對他們不利

- 單元測試會讓現有的流程增加多少時間
  - 代碼質量提高可以提高生產率，縮短項目時間。但撰寫測試會使編碼變慢？主要是靠增加可維護性和容易修復來減少開發時間
  - 在領導者提出時間問題時，背後的問題是：如果我們不能按計劃時間完成項目，我該怎麼跟其他人解釋呢？
    - 可能實際上認為流程是有用的，但是要未雨綢繆
    - 問的可能不是整個產品的時間，而是特定功能集成或是產品功能的開發時間
- 單元測試是否會搶了 QA 的飯碗
- 證明單元測試有效的方法
- 單元測試有用的證據
- QA 部門還是能找到缺陷的原因
- 確保測試中沒有缺陷的方法
  - 測試驅動開發
- 我的代碼已經調適通過了，但還需要測試的原因
- 測試驅動開發的必要性
