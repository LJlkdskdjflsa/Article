# 內容

- 理解隔離框架的概念
- 使用 Mock 創建存根或模擬對象
- 探索存根和模擬對象的高級用例
- 避免隔離框架中常見錯誤

優雅的方案：使用隔離框架(isolation framework)
用隔離框架創建
- 動態存根(dynamic stub)
- 動態模擬對象(dynamic mock object)

## 為什麼要使用隔離框架
定義：隔離框架是一套可編程的API，用於創建存根和模擬對象，以便在測試中隔離依賴項。比起手動快速/簡潔

## 動態生成偽對象
用 Mock 來代替真實的對象，這樣就可以測試真實的對象，而不用真實的對象

## 模擬值
讓動態偽對象返回一個值

使用隔離框架會降低代碼可讀性,但增加模擬對象的速度
如果斷言出現一個以上的 lambda 表達式, 就可以考慮使用手工偽對象

## 測試事件相關的活動

事件是雙向的,可以從兩個方向來測試
- 測試事件監聽者
- 事件接收者

### 測試事件監聽者
實現方式：
- 檢查對象內部狀態
  - 驗證它是否註冊接受另一對象發送的事件
  - 不推薦：
    - 註冊事件是內部/私有的代碼行為
    - 較難維護
    - 有過度指定問題
- 檢查監聽對象是否對發生的事做出響應
  - 如果監聽者沒有註冊到這個事件,它就不會採取任何可觀測到的行為

## 隔離框架的優缺點

優點：
- 更容易驗證參數
- 更容易驗證方法多次調用
- 更容易創建偽對象

陷阱：
- 測試代碼不可讀
- 驗證錯誤的東西
- 一個測試有多個模擬對象
  - 拆分測試
- 過度指定測試
  - 避免方法
    - 盡量使用非嚴格模擬對象
      - 減少預期之外的方法調用導致失敗的機會(如果產品代碼中的私有方法一直變化,用非嚴格模擬對象會很有幫助)
    - 盡量使用存根而非模擬對象
      - 模擬對象只用於驗證,其他地方用存根
    - 避免把存根當模擬對象使用
      - 存根用途：
        - 為被測試代碼偽造返回值/拋出異常


如果有超過 5% 測試使用模擬對象而非存根,你就可能過度指定了