# 優秀單元測試的支柱
- 編寫可靠的測試
- 編寫可維護的測試
- 編寫可讀的測試
- 探索單元測試的命名規範

優秀測試的三種屬性
- 可靠
- 可維護
- 可讀

## 編寫可靠的測試

關鍵點
- 決定何時刪除或修改測試
- 避免測試中的邏輯
- 只測試一個關注點
- 把單測和集測分開
- 推動代碼審察

### 決定何時刪除或修改測試
原因 -> 測試失敗
測試失敗原因
- 產品缺陷
- 測試缺陷
  - TDD -> 不斷調整測試
- 語意或 API 變更
- 衝突或是無效測試

遇到測試缺陷時,開發人員會經歷的過程
- 拒絕 -> 以為是代碼的問題
- 詫異
- 調適
- 頓悟

單元測試不該有的邏輯：
- switch
- if/else
- for loop

-> 包含邏輯的測試會一次測試多個東西 -> 測試的可讀性較差,也較為脆弱

過於複雜的測試將導致：
- 難以閱讀和理解
- 測試難以重現(ex. 多線程/隨機數)
- 較容易包含缺陷 or 測試錯誤的事
- 難以命名測試,因為它執行多件任務

單元測試心法：
- 直接 hard code 預期值
- 只測試一個關注點
- 用代碼審查確保代碼覆蓋率

## 編寫可維護的測試

- 只測試公共方法(不測試私有方法)
  - 私有方法可能更改或重構,導致測試失敗,但其實整體運行是正常的
  - 如果一定要測試私有方法,那這個方法應該是公共方法
- 刪除重複測試
  - 每個測試都需要獨立維護,徒增煩惱
  - 以"可維護"的方式使用 setup
  - 多用工廠方法 or helper method 來替代 setup
- 實施測試隔離
  - 如果沒有很好的測試隔離,他們會互相影響
  - 測試隔離可能有問題的點
    - 強制的測試順序
      - 單元測試應該不帶順序
      - 可能造成的原因
        - 流測試 -> 不要在單元測試中編寫流程相關測試
        - 懶於清理 -> 測試完後要清理自己的資料庫、內存中的對象
    - 隱藏的測試調用(調用其他測試)
    - 共享狀態損壞(集成測試共享狀態,卻沒有回滾資源)
    - 外部共享狀態損壞(集成測試共享資源,卻沒有回滾資源)

如果有隨機,可以用 contain 來增加維護的簡單程度

### 編寫可讀的測試

可讀性的三個層面
- 測試名稱
  - 包含
    - 被測試方法名
    - 測試場景
    - 預期行為
- 變數名稱
  - 盡量把字串都用 enum 表示
- 使用好的斷言信息
  - 盡量不要自訂斷言
- 把斷言和操作分離
- 盡量減少濫用 setup 和 teardown
  - 因為 setup 會讓你花額外時間去閱讀
    - 也不要在 setup 中初始化只有一兩個測試才會用到的物件
  - 會讓閱讀者意識不到到使用 setup 中產生的模擬對象
  - 在測試中直接產生模擬對象,會讓閱讀者更容易理解測試的意圖(不用去很多地方查看)
